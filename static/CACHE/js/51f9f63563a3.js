;(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{return Promise.resolve(value).then(function(value){step("next",value);},function(err){step("throw",err);});}}return step("next");});};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var ArrayUtils=function(){function ArrayUtils(){_classCallCheck(this,ArrayUtils);}
_createClass(ArrayUtils,null,[{key:'includes',value:function includes(array,key){return array.indexOf(key)!==-1;}}]);return ArrayUtils;}();var delegate=function delegate(parentSelector,event,selector,handler){var parentElement=document.querySelector(parentSelector);parentElement.addEventListener(event,function(e){var possibleTargets=parentElement.querySelectorAll(selector);var target=e.target;for(var i=0;i<possibleTargets.length;i+=1){var element=target;var possibleTarget=possibleTargets[i];while(element&&element!==parentElement){if(element===possibleTarget){return handler.call(possibleTarget,e);}
element=element.parentNode;}}});};var PersistingAttributesDataManager=function(){function PersistingAttributesDataManager(){_classCallCheck(this,PersistingAttributesDataManager);this._allowedAttributes=['email','firstName','lastName','phone','postalCode'];this._dataAtrribute='data-pa';this._dataForm='data-pa-form';this._dataNoSetAtrribute='data-pa-no-set';this._dataNoStoreAtrribute='data-pa-no-store';this._forms=[];this._localStorageKey='PersistingAttributes';this._data=this._getData();}
_createClass(PersistingAttributesDataManager,[{key:'_checkAttribute',value:function _checkAttribute(name){if(!ArrayUtils.includes(this._allowedAttributes,name)){throw new Error('Attribute with name "'+name+'" is not allowed.');}}},{key:'_getAttribute',value:function _getAttribute(name){var _this=this;return _asyncToGenerator(regeneratorRuntime.mark(function _callee(){var data;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this._checkAttribute(name);_context.next=3;return _this._data;case 3:data=_context.sent;return _context.abrupt('return',data[name]);case 5:case'end':return _context.stop();}}},_callee,_this);}))();}},{key:'_getData',value:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var data,response,serverData;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data=this._getLocalStorageData();if(data._synced){_context2.next=14;break;}
_context2.next=4;return fetch(window.endpoints.api.persistingAttributes);case 4:response=_context2.sent;if(!response.ok){_context2.next=13;break;}
_context2.next=8;return response.json();case 8:serverData=_context2.sent;this._syncData(serverData);data=this._getLocalStorageData();_context2.next=14;break;case 13:throw new Error('Failed to retrieve data from server.');case 14:return _context2.abrupt('return',data);case 15:case'end':return _context2.stop();}}},_callee2,this);}));function _getData(){return _ref2.apply(this,arguments);}
return _getData;}()},{key:'_getLocalStorageData',value:function _getLocalStorageData(){var stringifiedData=window.localStorage.getItem(this._localStorageKey);var data=JSON.parse(stringifiedData);if(!data){data={};this._allowedAttributes.forEach(function(attribute){data[attribute]=null;});data._synced=false;}
return data;}},{key:'_setAttribute',value:function _setAttribute(name,value){this._checkAttribute(name);var data=this._getLocalStorageData();data[name]=value;this._setLocalStorageData(data);}},{key:'_setLocalStorageData',value:function _setLocalStorageData(data){var stringifiedData=JSON.stringify(data);return window.localStorage.setItem(this._localStorageKey,stringifiedData);}},{key:'_syncData',value:function _syncData(serverData){var storageData=this._getLocalStorageData();this._allowedAttributes.forEach(function(attribute){if(storageData[attribute]===null){storageData[attribute]=serverData[attribute];}});storageData._synced=true;this._setLocalStorageData(storageData);}},{key:'addNoSet',value:function addNoSet(field){field.setAttribute(this._dataNoSetAtrribute,'');}},{key:'addNoStore',value:function addNoStore(field){field.setAttribute(this._dataNoStoreAtrribute,'');}},{key:'assign',value:function assign(form){var _this2=this;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this._forms.push(form);this.setAttributes(form,options);form.onsubmit=function(){_this2.storeAttributes(form,options);};}},{key:'clear',value:function clear(){window.localStorage.removeItem(this._localStorageKey);}},{key:'init',value:function init(){var forms=document.querySelectorAll('form['+this._dataForm+']');for(var i=0;i<forms.length;i+=1){var form=forms[i];if(!ArrayUtils.includes(this._forms,form)){this.assign(form);}}}},{key:'removeNoSet',value:function removeNoSet(field){field.removeAttribute(this._dataNoSetAtrribute);}},{key:'removeNoStore',value:function removeNoStore(field){field.removeAttribute(this._dataNoStoreAtrribute);}},{key:'resync',value:function resync(){var data=this._getLocalStorageData();data._synced=false;this._setLocalStorageData(data);}},{key:'setAttributes',value:function setAttributes(form){var _this3=this;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var fields,i,field,attribute,initialValue;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(options.beforeSet){options.beforeSet(form,options);}
fields=form.querySelectorAll('['+_this3._dataAtrribute+']:not(['+_this3._dataNoSetAtrribute+'])');i=0;case 3:if(!(i<fields.length)){_context3.next=20;break;}
field=fields[i];attribute=field.getAttribute(_this3._dataAtrribute);initialValue=field.value;if(!(initialValue==='')){_context3.next=17;break;}
_context3.prev=8;_context3.next=11;return _this3._getAttribute(attribute);case 11:field.value=_context3.sent;_context3.next=17;break;case 14:_context3.prev=14;_context3.t0=_context3['catch'](8);console.error(_context3.t0);case 17:i+=1;_context3.next=3;break;case 20:if(options.afterSet){options.afterSet(form,options);}
case 21:case'end':return _context3.stop();}}},_callee3,_this3,[[8,14]]);}))();}},{key:'storeAttributes',value:function storeAttributes(form){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(options.beforeStore){options.beforeStore(form,options);}
var fields=form.querySelectorAll('['+this._dataAtrribute+']:not(['+this._dataNoStoreAtrribute+'])');for(var i=0;i<fields.length;i+=1){var field=fields[i];var attribute=field.getAttribute(this._dataAtrribute);var value=field.value;if(value!==''){this._setAttribute(attribute,value);}}
if(options.afterStore){options.afterStore(form,options);}}}]);return PersistingAttributesDataManager;}();window.PersistingAttributesDataManager=new PersistingAttributesDataManager();delegate('body','click','.menu-item-logout',function(){window.PersistingAttributesDataManager.clear();});delegate('body','submit','.login-form',function(){window.PersistingAttributesDataManager.resync();});},{}]},{},[1]);